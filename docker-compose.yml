services:
  omni-search-engine:
    build: .
    container_name: omni-search-engine
    environment:
      - OPENAI_API_KEY
      - OBSIDIAN_VAULT_PATH=/vault
      - CHROMADB_PATH=/data/chromadb
      - WATCH_MODE=true
      - SHADOW_AI_DEBOUNCE=30
    volumes:
      # Mount source code for development (Read-Write bind mount)
      - .:/app:z
      # Mount the vault (Read-Write bind mount)
      - ${VAULT_PATH:-/home/user/vault}:/vault:rw,Z
      # Persist ChromaDB data (Named volume)
      - chroma_data:/data/chromadb
      # Mount Qwen configuration for authentication
      - ~/.qwen:/root/.qwen:rw,Z
    # Keep stdin open for MCP communication if needed
    stdin_open: true
    tty: false
    
    # Enable SSE mode
    command: ["python", "server.py", "--sse"]
    ports:
      - "8765:8765"

volumes:
  chroma_data:
