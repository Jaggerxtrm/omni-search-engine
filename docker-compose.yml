services:
  omni-search-engine:
    build: .
    container_name: omni-search-engine
    environment:
      - OPENAI_API_KEY
      - OBSIDIAN_VAULT_PATH=/vault
      - CHROMADB_PATH=/data/chromadb
      - WATCH_MODE
    volumes:
      # Mount the vault (Read-only bind mount)
      - ${VAULT_PATH:-/home/user/vault}:/vault:ro,Z
      # Persist ChromaDB data (Named volume)
      - chroma_data:/data/chromadb
    # Keep stdin open for MCP communication if needed
    stdin_open: true
    tty: false
    
    # Enable SSE mode
    command: ["python", "server.py", "--sse"]
    ports:
      - "8765:8765"

volumes:
  chroma_data:
